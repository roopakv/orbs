version: 2.1

orbs:
  orb-tools: circleci/orb-tools@8.27.3
  swissknife: roopakv/swissknife@dev:alpha

jobs:
  test_run_if_modified:
    executor: orb-tools/ubuntu
    working_directory: /home/circleci/orbs
    steps:
      - checkout
      - swissknife/run_if_modified:
          pattern: src
          steps-to-run:
            - run:
                command: |
                  echo "src was modified";
                  exit 0;
      - swissknife/run_if_modified:
          pattern: neverexists
          steps-to-run:
            - run:
                command: |
                  echo "neverexists was modified";
                  exit 1;

workflows:
  lint_pack-validate_publish-dev:
    jobs:
      - orb-tools/lint

      - orb-tools/pack:
          requires: [orb-tools/lint]

      - orb-tools/publish-dev:
          orb-name: roopakv/swissknife
          requires: [orb-tools/pack]

      - orb-tools/trigger-integration-workflow:
          name: trigger-integration-dev
          ssh-fingerprints: 39:1e:f6:7e:f0:aa:db:10:4e:84:30:6d:9c:dc:90:9e
          cleanup-tags: true
          requires: [orb-tools/publish-dev]
          filters:
            branches:
              ignore: master

      - orb-tools/trigger-integration-workflow:
          name: trigger-integration-master
          ssh-fingerprints: 39:1e:f6:7e:f0:aa:db:10:4e:84:30:6d:9c:dc:90:9e
          cleanup-tags: true
          tag: master
          requires: [orb-tools/publish-dev]
          filters:
            branches:
              only: master

  build:
    jobs:
      - test_run_if_modified

executors:
  nodeimg:
    docker:
      - image: circleci/node:stretch
